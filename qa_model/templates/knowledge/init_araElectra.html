{% extends "home/base.html" %}
{% load static %}

{% block content %}

<header class="dx-header dx-box-5">
    <div class="container">
        <div class="bg-image bg-image-parallax">
            <img src="{% static 'assets/images/cover.jpg' %}" class="jarallax-img" alt="">
            <div style="background-color: rgba(27, 27, 27, .8);"></div>
        </div>

        <div class="container mnb-8">
            <h1 class="h4 mb-10 text-white text-center">تهيئة قاعدة المعرفة</h1>
            <!-- START: Breadcrumbs -->
            <ul class="dx-breadcrumbs text-center">
                <li><a href="{% url 'home' %}">الصفحة الرئيسية</a></li>
                <li>إدارة قاعدة المعرفة</li>
                <li>تهيئة قاعدة المعرفة</li>
            </ul>
            <!-- END: Breadcrumbs -->
        </div>
    </div>
</header>

<!-- End of header -->
<!-- Start of Content -->
<div class="dx-box-5 bg-grey-6">
    <div class="container">
        <div class="row align-items-center justify-content-between vertical-gap mnt-30 sm-gap mb-50">
            <div class="col-auto">
                <h2 class="h4 mb-0 mt-0">التهيئة الحالية لقاعدة المعرفة</h2>
            </div>
            <div class="col pl-30 pr-30 d-none d-sm-block">
                <div class="dx-separator ml-10 mr-10"></div>
            </div>
            <div class="col-auto">
                <a href="{% url 'update_context' %}" class="dx-btn dx-btn-md">تحميل مجال المعرفة</a>
            </div>
        </div>
        {% comment %} {% for row in knowledge %}
        <div class="dx-ticket-item dx-ticket-new dx-ticket-open dx-block-decorated" >
            <div class="dx-ticket-cont" style="padding-right: 10px;">
                <p class="dx-ticket-name">الملف</p>
                <p class="dx-ticket-title h7">{{ row.file.name | truncatewords_html:3}}</p>
            </div>
            <div class="dx-ticket-cont" style="padding-right: 10px;">
                <p class="dx-ticket-name">النص</p>
                <p class="dx-ticket-title h7">{{ row.get_text_clean  | safe | truncatewords_html:10  }}</p>
            </div>
            <div class="dx-ticket-cont" style="padding-right: 10px;">
                <p class="dx-ticket-name">الانشاء</p>
                <p class="dx-ticket-title h7">{{ row.pub_date }}</p>
            </div>
            <div class="dx-ticket-cont" style="padding-right: 10px;">
                <p class="dx-ticket-name">اخر تعديل</p>
                <p class="dx-ticket-title h7">{{ row.updated }}</p>
            </div>
            <div class="dx-ticket-info">
                <p>خيارات </p>
                <a class="dx-btn" href="{% url 'edit_k' %}">تعديل</a>
            </div>
        </div>
        {% endfor %} {% endcomment %}

        <div class="dx-box-decorated">
            <div class="dx-box-content">  
                <div class="row" style="padding-bottom: 15px;">
                    <div class="col-md-2">
                        <label>مجال المعرفة</label>
                        <label>عدد الكلمات: {{ context| wordcount  }}</label>
                    </div>
                    <div class="col-md-10">
                        <p class="text-justify">{{ context| truncatewords:400 }}</p>
                    </div>
                </div>
                <h4 class="text-center">اختبار النموذج</h4>
                <div class="row" style="padding-bottom: 15px;">
                    
                    <div class="col-md-7">
                        <form method="POST" class="dx-form" action="{% url 'test_qa' %}" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="dx-box-content">
                                <div class="dx-form-group">
                                    <label  for="question" class="mnt-7">السؤال</label>
                                    <input class="form-control form-control-style-2"  type="text" id="question" name="question" style="text-align: right; direction:rtl;" value="{{ question }}">
                                </div>
                                <div class="dx-form-group">
                                    <button type="submit" class="dx-btn dx-btn-xl dx-btn-block">استعلام</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-center"> النتائج </h4>
                        {% if answer %}
                        <h7>الجواب:</h7>
                        <p class="text-justify">  {{ answer }} </p>
                        {% endif %}
                        {% if score %}
                        <h7>score:</h7>
                        <p> {{ score | floatformat:4 }} </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="dx-separator"></div>


{% endblock %}